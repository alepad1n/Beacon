(()=>{"use strict";function e(e,t,i){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var a=i.call(e,"string");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}class t{static show(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok";return this.confirm(e,t,i,null)}static confirm(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Cancel";return new Promise(((r,n)=>{var s=document.getElementById("overlay"),d=document.getElementById("dialog"),c=document.getElementById("dialog_message"),o=document.getElementById("dialog_explanation"),l=document.getElementById("dialog_action_button"),h=document.getElementById("dialog_cancel_button");s&&d&&c&&o&&l&&h?(s.className="exist",d.className="exist",setTimeout((()=>{s.className="exist visible",d.className="exist visible"}),10),c.innerText=e,o.innerText=t||"",l.clickHandler&&l.removeEventListener("click",l.clickHandler),h.clickHandler&&h.removeEventListener("click",h.clickHandler),l.clickHandler=()=>{this.hide(),setTimeout((()=>{r()}),300)},l.addEventListener("click",l.clickHandler),l.innerText=i,a?(h.clickHandler=()=>{this.hide(),setTimeout((()=>{n()}),300)},h.addEventListener("click",h.clickHandler),h.innerText=a):h.className="hidden"):n()}))}static hide(){var e=document.getElementById("overlay"),t=document.getElementById("dialog");e&&t&&(e.className="exist",t.className="exist",setTimeout((()=>{e.className="",t.className=""}),300))}static showModal(e){if(!this.activeModal){var t=document.getElementById("overlay"),i=document.getElementById(e);t&&i&&(t.classList.add("exist"),i.classList.add("exist"),this.activeModal=e,setTimeout((()=>{t.classList.add("visible"),i.classList.add("visible")}),10),this.viewportWatcher=setInterval((()=>{if(this.activeModal){document.querySelectorAll("#".concat(this.activeModal," .modal-content .content")).forEach((e=>{i.classList.toggle("scrolled",e.scrollHeight>e.clientHeight)}));var e=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);i.classList.toggle("centered",i.clientHeight>.75*e)}}),100))}}static hideModal(){return new Promise(((e,t)=>{if(this.activeModal){var i=document.getElementById("overlay"),a=document.getElementById(this.activeModal);i&&a?(this.viewportWatcher&&(clearInterval(this.viewportWatcher),this.viewportWatcher=null),i.classList.remove("visible"),a.classList.remove("visible"),setTimeout((()=>{i.classList.remove("exist"),a.classList.remove("exist"),this.activeModal=null,e()}),300)):t()}else t()}))}}e(t,"activeModal",null),e(t,"viewportWatcher",null);class i{static prepareResponse(e){return{xhr:e,status:e.status,statusText:e.statusText,body:e.responseText,success:e.status>=200&&e.status<300||304===e.status}}static start(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new Promise(((r,n)=>{var s=new XMLHttpRequest;if(s.open(e,t,!0),"object"==typeof a&&null!==a&&!1===Array.isArray(a)){var d=Object.keys(a);for(var c of d)s.setRequestHeader(c,a[c])}s.onload=()=>{var e=this.prepareResponse(s);e.success?r(e):n(e)},s.onerror=()=>{n(this.prepareResponse(s))},s.send(i)}))}static get(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i.start("GET",e,null,t)}static post(e,t){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return t instanceof URLSearchParams?(a["Content-Type"]="application/x-www-form-urlencoded",i.start("POST",e,t.toString(),a)):"object"==typeof t&&null!==t||Array.isArray(t)?(a["Content-Type"]="application/json",i.start("POST",e,JSON.stringify(t),a)):i.start("POST",e,t,a)}static delete(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return i.start("DELETE",e,null,t)}}var a=e=>Intl.NumberFormat("en-US",{style:"currency",currency:e}).format,r=e=>new Date(1e3*e),n=(e,t)=>{var i={dateStyle:"medium"};return t&&(i.timeStyle="short"),Intl.DateTimeFormat(Intl.DateTimeFormat().resolvedOptions().locale,i).format(e)};function s(e,t,i){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,i)}function d(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,o(e,t,"get"))}function c(e,t,i){return function(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}(e,o(e,t,"set"),i),i}function o(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}var l="owns",h="buying",u="in-cart",k="none";document.addEventListener("beaconRunCheckout",(e=>{var{checkoutProperties:o}=e,m=o.products,v=o.productIds,p=a(o.currencyCode),g=new WeakMap,f=new WeakMap,y=new WeakMap;class A{constructor(e){s(this,g,{writable:!0,value:null}),s(this,f,{writable:!0,value:{}}),s(this,y,{writable:!0,value:!1}),e?(c(this,g,e.id),c(this,f,e.products),c(this,y,e.isGift)):c(this,g,crypto.randomUUID())}get id(){return d(this,g)}get isGift(){return d(this,y)}set isGift(e){c(this,y,e)}get productIds(){return Object.keys(d(this,f))}get count(){return Object.keys(d(this,f)).length}reset(){c(this,f,{})}add(e,t){this.setQuantity(e,this.getQuantity(e)+t)}remove(e,t){this.setQuantity(e,this.getQuantity(e)-t)}getQuantity(e){var t;return null!==(t=d(this,f)[e])&&void 0!==t?t:0}setQuantity(e,t){t<=0?Object.prototype.hasOwnProperty.call(d(this,f),e)&&delete d(this,f)[e]:d(this,f)[e]=t}toJSON(){return{id:d(this,g),products:d(this,f),isGift:d(this,y)}}get fingerprint(){var e=Object.keys(d(this,f)).sort().reduce(((e,t)=>(e[t]=d(this,f)[t],e)),{});return btoa(JSON.stringify({id:d(this,g),products:e,isGift:d(this,y)}))}get hasArk(){var e;return this.getQuantity(null==m||null===(e=m.Ark)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)>0}get hasArkSA(){var e,t,i;return this.getQuantity(null==m||null===(e=m.ArkSA)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)>0||this.getQuantity(null==m||null===(t=m.ArkSA)||void 0===t||null===(t=t.Upgrade)||void 0===t?void 0:t.ProductId)>0||this.getQuantity(null==m||null===(i=m.ArkSA)||void 0===i||null===(i=i.Renewal)||void 0===i?void 0:i.ProductId)>0}get arkSAYears(){var e,t,i;return Math.min(this.getQuantity(null==m||null===(e=m.ArkSA)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)+this.getQuantity(null==m||null===(t=m.ArkSA)||void 0===t||null===(t=t.Upgrade)||void 0===t?void 0:t.ProductId)+this.getQuantity(null==m||null===(i=m.ArkSA)||void 0===i||null===(i=i.Renewal)||void 0===i?void 0:i.ProductId),10)}build(e,t,i,a){this.reset(),this.isGift=t,i&&(t||null===e.arkLicense)&&this.setQuantity(m.Ark.Base.ProductId,1),a>0&&(a=Math.min(a,5),t?(i?this.setQuantity(m.ArkSA.Upgrade.ProductId,1):this.setQuantity(m.ArkSA.Base.ProductId,1),a>1&&this.setQuantity(m.ArkSA.Renewal.ProductId,a-1)):null!==e.arkSALicense?this.setQuantity(m.ArkSA.Renewal.ProductId,a):(i||null!==e.arkLicense?this.setQuantity(m.ArkSA.Upgrade.ProductId,1):this.setQuantity(m.ArkSA.Base.ProductId,1),a>1&&this.setQuantity(m.ArkSA.Renewal.ProductId,a-1)))}rebuild(e){var t=this.fingerprint;return this.build(e,this.isGift,this.hasArk,this.arkSAYears),this.fingerprint!==t}consume(e,t){if(t){if(this.isGift!==t.isGift)throw new Error("Cannot merge a gift item with a non-gift item.");var i=this.hasArk||t.hasArk,a=this.arkSAYears+t.arkSAYears;this.build(e,this.isGift,i,a)}}get total(){var e=this.productIds,t=0;for(var i of e)t+=v[i].Price*this.getQuantity(i);return t}}var w=new WeakMap,S=new WeakMap,E=new WeakMap,b=new WeakMap,C=class{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(s(this,w,{writable:!0,value:[]}),s(this,S,{writable:!0,value:null}),s(this,E,{writable:!0,value:!1}),s(this,b,{writable:!0,value:[]}),e)try{var t=JSON.parse(e);c(this,S,t.email),c(this,w,t.items.reduce(((e,t)=>{var i=new A(t);return i.count>0&&e.push(i),e}),[])),c(this,b,t.licenses)}catch(e){console.log("Failed to load saved cart")}}reset(){c(this,w,[]),c(this,S,null),c(this,E,!1),c(this,b,[]),this.save()}toJSON(){return{email:d(this,S),items:d(this,w).reduce(((e,t)=>(t.count>0&&e.push(t),e)),[]),licenses:d(this,b)}}save(){localStorage.setItem("beaconCart",JSON.stringify(this))}static load(){return new this(localStorage.getItem("beaconCart"))}add(e){d(this,w).push(e),this.save()}remove(e){c(this,w,d(this,w).filter((t=>t.id!==e.id))),this.save()}hasProduct(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];for(var i of d(this,w))if(i.getQuantity(e)>0&&i.isGift===t)return!0;return!1}get email(){return d(this,S)}setEmail(e){return new Promise(((t,a)=>{var r=()=>{var e,t=this.personalCartItem;return!!t&&(t.hasArk&&this.arkLicense?(t.setQuantity(null===(e=m.Ark)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId,0),0===t.count&&this.remove(t),!0):t.rebuild(this))};if(null===e){c(this,S,null),c(this,E,!1),c(this,b,[]);var n=r();return this.save(),void t({newEmail:null,cartChanged:n})}if(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).trim().toLowerCase())){var s=new URLSearchParams;s.append("email",e),i.get("/omni/lookup?".concat(s.toString())).then((i=>{var a=JSON.parse(i.body);c(this,S,a.email),c(this,E,a.verified),c(this,b,a.purchases);var n=r();this.save(),t({newEmail:e,cartChanged:n})})).catch((e=>{c(this,S,null),c(this,E,!1),c(this,b,[]),r(),this.save(),a(e.statusText)}))}else a("Address is not valid")}))}get emailVerified(){return d(this,E)}get checkingEmail(){return!1}get items(){return[...d(this,w)]}get count(){return d(this,w).reduce(((e,t)=>(t.count>0&&e++,e)),0)}findLicense(e){for(var t of d(this,b))if(t.productId===e)return t;return null}get arkLicense(){var e;return this.findLicense(null==m||null===(e=m.Ark)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)}get arkSALicense(){var e;return this.findLicense(null==m||null===(e=m.ArkSA)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)}get ark2License(){return null}get personalCartItem(){for(var e of d(this,w))if(!1===e.isGift)return e;return null}get total(){var e=0;for(var t of d(this,w))e+=t.total;return e}}.load(),B=new WeakMap,I=new WeakMap;class L{constructor(e){s(this,B,{writable:!0,value:[]}),s(this,I,{writable:!0,value:null}),d(this,B).push(e)}get currentView(){return d(this,B).slice(-1)}back(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return!(d(this,B).length<=1||(this.switchView(d(this,B)[d(this,B).length-2],e),c(this,B,d(this,B).slice(0,d(this,B).length-2)),0))}clearHistory(){d(this,B).length<=1||c(this,B,d(this,B).slice(-1))}switchView(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.currentView!==e){d(this,I)&&(clearTimeout(d(this,I)),c(this,I,null));var i=document.getElementById(this.currentView),a=document.getElementById(e);d(this,B).push(e),t?(i.classList.add("invisible"),c(this,I,setTimeout((()=>{i.classList.add("hidden"),a.classList.remove("hidden"),c(this,I,setTimeout((()=>{a.classList.remove("invisible"),c(this,I,null)}),150))}),150))):(i.classList.add("hidden"),i.classList.add("invisible"),a.classList.remove("invisible"),a.classList.remove("hidden"))}}}new L("checkout-wizard-start");var T=new L("page-landing"),x=document.getElementById("buy-button"),P=document.getElementById("cart-back-button"),F=1===Object.keys(v).length,O=()=>{history.pushState({},"","/omni/#checkout"),dispatchEvent(new PopStateEvent("popstate",{}))},M={cancelButton:document.getElementById("checkout-email-cancel"),actionButton:document.getElementById("checkout-email-action"),emailField:document.getElementById("checkout-email-field"),errorField:document.getElementById("checkout-email-error"),allowsSkipping:!1,successFunction:function(e){},init:function(){var e=e=>{this.actionButton.disabled=!0,this.cancelButton.disabled=!0,this.errorField.classList.add("hidden"),C.setEmail(e).then((e=>{var{newEmail:i,cartChanged:a}=e;t.hideModal(),setTimeout((()=>{this.successFunction(a)}),310)})).catch((e=>{this.errorField.innerText=e,this.errorField.classList.remove("hidden")})).finally((()=>{this.actionButton.disabled=!1,this.cancelButton.disabled=!1}))};this.actionButton.addEventListener("click",(t=>{t.preventDefault(),e(this.emailField.value)})),this.cancelButton.addEventListener("click",(i=>{i.preventDefault(),this.allowsSkipping?e(null):t.hideModal()}))},present:function(e,i){this.allowsSkipping=e,this.successFunction=i,C.email?this.emailField.value=C.email:this.emailField.value=sessionStorage.getItem("email")||localStorage.getItem("email")||"",this.cancelButton.innerText=e?"Skip For Now":"Cancel",t.showModal("checkout-email")}};M.init();var D={cartView:null,editCartItem:null,cancelButton:document.getElementById("checkout-wizard-cancel"),actionButton:document.getElementById("checkout-wizard-action"),giftCheck:document.getElementById("checkout-wizard-gift-check"),arkSACheck:document.getElementById("checkout-wizard-arksa-check"),arkCheck:document.getElementById("checkout-wizard-ark-check"),arkPriceField:document.getElementById("checkout-wizard-ark-price"),arkSAPriceField:document.getElementById("checkout-wizard-arksa-full-price"),arkSAUpgradePriceField:document.getElementById("checkout-wizard-arksa-discount-price"),arkSAStatusField:document.getElementById("checkout-wizard-status-arksa"),arkStatusField:document.getElementById("checkout-wizard-status-ark"),arkSADurationGroup:document.getElementById("checkout-wizard-arksa-duration-group"),arkSADurationField:document.getElementById("checkout-wizard-arksa-duration-field"),arkSADurationUpButton:document.getElementById("checkout-wizard-arksa-yearup-button"),arkSADurationDownButton:document.getElementById("checkout-wizard-arksa-yeardown-button"),arkSAPromoField:document.getElementById("checkout-wizard-promo-arksa"),arkOnlyCheck:document.getElementById("storefront-ark-check"),arkOnlyGiftField:document.getElementById("storefront-ark-gift-field"),arkOnlyOwnedField:document.getElementById("storefront-ark-owned"),arkOnlyGiftQuantityGroup:document.getElementById("storefront-ark-gift-group"),arkOnlyGiftUpButton:document.getElementById("storefront-ark-gift-increase"),arkOnlyGiftDownButton:document.getElementById("storefront-ark-gift-decrease"),init:function(e){if(this.cartView=e,this.cancelButton&&this.cancelButton.addEventListener("click",(e=>{e.preventDefault(),t.hideModal()})),this.actionButton&&this.actionButton.addEventListener("click",(e=>{e.preventDefault();var i=this.giftCheck.checked,a=this.arkCheck&&!1===this.arkCheck.disabled&&this.arkCheck.checked,r=this.arkSACheck&&!1===this.arkSACheck.disabled&&this.arkSACheck.checked;if(!1!==(a||r)){var n,s=r?parseInt(this.arkSADurationField.value)||1:0;if(this.editCartItem?n=this.editCartItem:(n=new A).isGift=i,n.build(C,i,a,s),!1===Boolean(this.editCartItem)){var d=C.personalCartItem;!1===i&&!0===Boolean(d)?d.consume(C,n):C.add(n)}C.save(),this.cartView.update(),O(),t.hideModal()}})),this.giftCheck&&this.giftCheck.addEventListener("change",(()=>{this.update()})),this.arkCheck&&this.arkCheck.addEventListener("change",(()=>{this.update()})),this.arkSACheck&&this.arkSADurationField&&this.arkSADurationUpButton&&this.arkSADurationDownButton&&this.arkSADurationGroup){this.arkSACheck.addEventListener("change",(()=>{this.update()})),this.arkSADurationField.addEventListener("input",(()=>{this.update()}));var i=e=>{var t=parseInt(this.arkSADurationField.value),i=t+e;(i>5||i<1)&&(this.arkSADurationGroup.classList.add("shake"),setTimeout((()=>{this.arkSADurationGroup.classList.remove("shake")}),400),i=Math.max(Math.min(i,5),1)),t!==i&&(this.arkSADurationField.value=i,this.arkSACheck.checked=!0,this.update())};this.arkSADurationUpButton.addEventListener("click",(e=>{e.preventDefault(),i(1)})),this.arkSADurationDownButton.addEventListener("click",(e=>{e.preventDefault(),i(-1)}))}if(this.arkOnlyCheck&&this.arkOnlyCheck.addEventListener("change",(e=>{if(e.preventDefault(),e.currentTarget.checked){var t=C.personalCartItem;t||(t=new A,C.add(t)),t.build(C,!1,!0,0),C.save()}else{var i=C.personalCartItem;i&&C.remove(i)}this.cartView.update()})),this.arkOnlyGiftField){var a=e=>{var t=C.items.filter((e=>!0===e.isGift&&e.hasArk));if(t.length!==e){if(t.length>e)for(var i=e;i<=t.length-1;i++)C.remove(t[i]);else if(t.length<e)for(var a=t.length;a<e;a++){var r=new A;r.build(C,!0,!0,0),C.add(r)}this.cartView.update()}};this.arkOnlyGiftField.addEventListener("input",(e=>{var t=Math.min(Math.max(parseInt(e.currentTarget.value),0),5);a(t)})),this.arkOnlyGiftField.addEventListener("blur",(()=>{this.cartView.update()}));var r=e=>{var t=parseInt(this.arkOnlyGiftField.value),i=t+e;(i>5||i<0)&&(this.arkOnlyGiftQuantityGroup.classList.add("shake"),setTimeout((()=>{this.arkOnlyGiftQuantityGroup.classList.remove("shake")}),400),i=Math.max(Math.min(i,5),0)),t!==i&&(this.arkOnlyGiftField.value=i,a(i))};this.arkOnlyGiftUpButton.addEventListener("click",(e=>{e.preventDefault(),r(1)})),this.arkOnlyGiftDownButton.addEventListener("click",(e=>{e.preventDefault(),r(-1)}))}},present:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.editCartItem=e,this.arkCheck.disabled=!1,this.arkSACheck&&(this.arkSACheck.disabled=!1),e?(this.giftCheck.checked=e.isGift,this.giftCheck.disabled=!0,this.arkCheck.checked=e.hasArk,this.arkSACheck&&(this.arkSACheck.checked=e.hasArkSA)):(this.giftCheck.checked=!1,this.giftCheck.disabled=!1,this.arkCheck.checked=!1,this.arkSACheck&&(this.arkSACheck.checked=!1)),this.arkSADurationField&&(this.arkSADurationField.value=e?e.arkSAYears:"1"),this.cancelButton.innerText="Cancel",this.update(),t.showModal("checkout-wizard")},getGameStatus:function(){var e={Ark:k,ArkSA:k},t=C.personalCartItem,i=Boolean(this.editCartItem);return this.giftCheck&&this.giftCheck.checked?(e.Ark=this.arkCheck&&!1===this.arkCheck.disabled&&this.arkCheck.checked?h:k,e.ArkSA=this.arkSACheck&&!1===this.arkSACheck.disabled&&this.arkSACheck.checked?h:k):(C.arkLicense?e.Ark=l:t&&(!1===i||t.id!==this.editCartItem.id)&&t.hasArk?e.Ark=u:this.arkCheck&&!1===this.arkCheck.disabled&&this.arkCheck.checked?e.Ark=h:e.Ark=k,C.arkSALicense?e.ArkSA=l:t&&(!1===i||t.id!==this.editCartItem.id)&&t.hasArkSA?e.ArkSA=u:this.arkSACheck&&this.arkSACheck&&!1===this.arkSACheck.disabled&&this.arkSACheck.checked?e.ArkSA=h:e.ArkSA=k),e},update:function(){var e=this.getGameStatus(),t=0;if(this.arkCheck&&!1===this.arkCheck.disabled&&!0===this.arkCheck.checked&&(t+=m.Ark.Base.Price),this.arkSACheck){var i=m.ArkSA.Base.Price,a=m.ArkSA.Base.Price,s=Math.min(Math.max(parseInt(this.arkSADurationField.value)||1,1),5);parseInt(this.arkSADurationField.value)!==s&&document.activeElement!==this.arkSADurationField&&(this.arkSADurationField.value=s);var d=Math.max(s-1,0),c=Math.round((m.ArkSA.Base.Price-m.ArkSA.Upgrade.Price)/m.ArkSA.Base.Price*100);if(this.arkSAPromoField.innerText="".concat(c,"% off first year when bundled with ").concat(m.Ark.Base.Name),e.ArkSA===l){var o,h=C.arkSALicense,v=Math.floor(Date.now()/1e3),g=h.expires_epoch,f=n(r(g),!1),y=(v>g?86400*Math.floor(v/86400)+86400:g)+m.ArkSA.Renewal.PlanLengthSeconds*s,A=n(r(y),!1);o=v>g?'Renew your update plan<br>Expired on <span class="text-red">'.concat(f,'</span><br>New expiration: <span class="text-green">').concat(A,"</span>"):'Extend your update plan<br>Expires on <span class="text-green">'.concat(f,'</span><br>New expiration: <span class="text-green">').concat(A,"</span>"),this.arkSAStatusField.innerHTML=o,a=i=m.ArkSA.Renewal.Price*s,this.arkSAPromoField.innerText="",this.arkSAPromoField.classList.add("hidden")}else if(e.ArkSA===u)a=i=m.ArkSA.Renewal.Price*s,this.arkSAStatusField.innerText="Additional renewal years for ".concat(m.ArkSA.Base.Name," in your cart."),this.arkSAPromoField.innerText="",this.arkSAPromoField.classList.add("hidden");else if(e.Ark!==k){i=m.ArkSA.Base.Price+m.ArkSA.Renewal.Price*d,a=m.ArkSA.Upgrade.Price+m.ArkSA.Renewal.Price*d;var w=e.Ark===l?"because you own":"when bundled with";this.arkSAStatusField.innerText="Includes first year of app updates. Additional years cost ".concat(p(m.ArkSA.Renewal.Price)," each."),this.arkSAPromoField.innerText="".concat(c,"% off first year ").concat(w," ").concat(m.Ark.Base.Name),this.arkSAPromoField.classList.remove("hidden")}else this.arkSAStatusField.innerText="Includes first year of app updates. Additional years cost ".concat(p(m.ArkSA.Renewal.Price)," each."),this.arkSAPromoField.innerText="".concat(c,"% off first year when bundled with ").concat(m.Ark.Base.Name),this.arkSAPromoField.classList.remove("hidden"),a=i=m.ArkSA.Base.Price+m.ArkSA.Renewal.Price*d;this.arkSAPriceField.classList.toggle("checkout-wizard-discounted",i!==a),this.arkSAPriceField.innerText=p(i),this.arkSAUpgradePriceField.classList.toggle("hidden",i===a),this.arkSAUpgradePriceField.innerText=p(a),!1===this.arkSACheck.disabled&&!0===this.arkSACheck.checked&&(t+=a)}e.Ark===l?(this.arkStatusField.innerText="You already own ".concat(m.Ark.Base.Name,"."),this.arkCheck.disabled=!0,this.arkCheck.checked=!1):e.Ark===u?(this.arkStatusField.innerText="".concat(m.Ark.Base.Name," is already in your cart."),this.arkCheck.disabled=!0,this.arkCheck.checked=!1):(this.arkStatusField.innerText="Includes lifetime app updates.",this.arkCheck.disabled=!1);var S=this.editCartItem?"Edit":"Add to Cart";t>0?(this.actionButton.disabled=!1,this.actionButton.innerText="".concat(S,": ").concat(p(t))):(this.actionButton.disabled=!0,this.actionButton.innerText=S)}},G={wizard:null,emailField:document.getElementById("storefront-cart-header-email-field"),changeEmailButton:document.getElementById("storefront-cart-header-email-button"),currencyMenu:document.getElementById("storefront-cart-currency-menu"),addMoreButton:document.getElementById("storefront-cart-more-button"),checkoutButton:document.getElementById("storefront-cart-checkout-button"),footer:document.getElementById("storefront-cart-footer"),body:document.getElementById("storefront-cart"),totalField:document.getElementById("storefront-cart-total"),init:function(e){this.wizard=e,this.currencyMenu.addEventListener("change",(e=>{e.preventDefault(),i.get("/omni/currency?currency=".concat(e.target.value)).then((()=>{window.location.reload()})).catch((e=>{console.log(JSON.stringify(e)),t.show("Currency was not changed",e.statusText)}))})),this.addMoreButton.addEventListener("click",(e=>{e.preventDefault(),this.wizard.present()})),this.checkoutButton.addEventListener("click",(e=>{e.preventDefault();var a=e=>{this.update(),e?C.count>0?t.show("Your cart contents have changed.","The items in your cart have changed based on your e-mail address. Please review before continuing checkout."):t.show("Your cart is now empty.","You already own everything in your cart. There is no need to purchase again."):(this.checkoutButton.disabled=!0,i.post("/omni/begin",C).then((e=>{try{var i=JSON.parse(e.body),a=i.url;sessionStorage.setItem("clientReferenceId",i.client_reference_id),window.location=a}catch(i){console.log(e.body),t.show("Unknown Error","There was an unknown error while starting the checkout process.")}})).catch((e=>{try{var i=JSON.parse(e.body).message;t.show("Checkout Error",i)}catch(i){console.log(e.body),t.show("Unknown Error","There was an unknown error while starting the checkout process.")}})).finally((()=>{this.checkoutButton.disabled=!1})))};C.email?a(!1):M.present(!1,a)})),this.changeEmailButton.addEventListener("click",(e=>{e.preventDefault(),M.present(!1,(()=>{this.update()}))})),this.update()},update:function(){if(F){this.emailField.innerText=C.email,this.changeEmailButton.innerText=C.email?"Change Email":"Set Email",this.changeEmailButton.classList.remove("hidden"),this.addMoreButton.classList.add("hidden"),C.arkLicense?(this.wizard.arkOnlyOwnedField.classList.remove("hidden"),this.wizard.arkOnlyCheck.parentElement.classList.add("hidden")):(this.wizard.arkOnlyOwnedField.classList.add("hidden"),this.wizard.arkOnlyCheck.parentElement.classList.remove("hidden"));var e=C.personalCartItem;if(this.wizard.arkOnlyCheck.checked=e&&e.hasArk,document.activeElement!==this.wizard.arkOnlyGiftField){var t=C.items.filter((e=>!0===e.isGift&&e.hasArk));this.wizard.arkOnlyGiftField.value=t.length}}else if(C.count>0)this.emailField.innerText=C.email,this.changeEmailButton.innerText=C.email?"Change Email":"Set Email",this.changeEmailButton.classList.remove("hidden"),this.body.innerText="",this.body.classList.remove("empty"),this.footer.classList.remove("hidden"),C.items.forEach((e=>{var t=this.createCartItemRow(e);t&&this.body.appendChild(t)})),x.innerText="Go to Cart";else{this.emailField.innerText="",this.changeEmailButton.classList.add("hidden"),this.body.innerText="",this.body.classList.add("empty"),this.footer.classList.add("hidden"),this.body.appendChild(document.createElement("div"));var i=document.createElement("div"),r=document.createElement("p");r.appendChild(document.createTextNode("Your cart is empty.")),i.appendChild(r),this.buyMoreButton=document.createElement("button"),this.buyMoreButton.addEventListener("click",(()=>{M.present(!0,(()=>{this.wizard.present()}))})),this.buyMoreButton.classList.add("default"),this.buyMoreButton.appendChild(document.createTextNode("Buy Omni"));var n=document.createElement("p");n.appendChild(this.buyMoreButton),i.appendChild(n),this.body.appendChild(i),this.body.appendChild(document.createElement("div")),x.innerText="Buy Omni"}var s;this.totalField.setAttribute("beacon-price",C.total),s=o.currencyCode,document.querySelectorAll(".formatted-price").forEach((e=>{var t,i=parseFloat(null!==(t=e.getAttribute("beacon-price"))&&void 0!==t?t:e.innerText),r=e.getAttribute("beacon-currency"),n=a(null!=r?r:s);n&&(e.innerText=n(i))})),this.checkoutButton.disabled=0===C.total},createProductRow:function(e,t){var i=e.getQuantity(t);if(i<=0)return null;var a=v[t].Name,r=v[t].Price,n=document.createElement("div");n.appendChild(document.createTextNode(i));var s=document.createElement("div");s.appendChild(document.createTextNode(a));var d=document.createElement("div");d.classList.add("formatted-price"),d.appendChild(document.createTextNode(r*i));var c=document.createElement("div");return c.classList.add("bundle-product"),c.appendChild(n),c.appendChild(s),c.appendChild(d),c},createCartItemRow:function(e){var t=e.productIds;if(t.length<=0)return null;var i=document.createElement("div");i.classList.add("bundle"),t.forEach((t=>{var a=this.createProductRow(e,t);a&&i.appendChild(a)}));var a=document.createElement("div");e.isGift&&(i.classList.add("gift"),a.classList.add("gift"),t.length>1?a.appendChild(document.createTextNode("These products are a gift. You will receive a gift code for them.")):a.appendChild(document.createTextNode("This product is a gift. You will receive a gift code for it.")));var r=document.createElement("button");r.appendChild(document.createTextNode("Edit")),r.classList.add("small"),r.addEventListener("click",(t=>{t.preventDefault(),this.wizard.present(e)}));var n=document.createElement("button");n.appendChild(document.createTextNode("Remove")),n.classList.add("red"),n.classList.add("small"),n.addEventListener("click",(t=>{t.preventDefault(),C.remove(e),this.update()}));var s=document.createElement("div");s.classList.add("button-group"),s.appendChild(r),s.appendChild(n);var d=document.createElement("div");d.appendChild(s);var c=document.createElement("div");return c.classList.add("actions"),c.classList.add("double-group"),c.appendChild(a),c.appendChild(d),i.appendChild(c),i}};D.init(G),G.init(D);var N=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];window.scrollTo(window.scrollX,0),"#checkout"===window.location.hash?T.switchView("page-cart",e):T.back(e)};x.addEventListener("click",(e=>{e.preventDefault(),F||C.count>0?O():M.present(!0,(()=>{D.present()}))})),P.addEventListener("click",(()=>{history.pushState({},"","/omni/"),dispatchEvent(new PopStateEvent("popstate",{}))})),window.addEventListener("popstate",(()=>{N(!0)})),N(!1)}))})();
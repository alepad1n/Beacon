(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,i(r.key),r)}}function n(e,t,n){return(t=i(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(t){var n=function(t,n){if("object"!==e(t)||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var r=i.call(t,"string");if("object"!==e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===e(n)?n:String(n)}var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,i;return n=e,i=[{key:"show",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok";return this.confirm(e,t,n,null)}},{key:"confirm",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Ok",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Cancel";return new Promise((function(a,o){var c=document.getElementById("overlay"),s=document.getElementById("dialog"),l=document.getElementById("dialog_message"),u=document.getElementById("dialog_explanation"),d=document.getElementById("dialog_action_button"),h=document.getElementById("dialog_cancel_button");c&&s&&l&&u&&d&&h?(c.className="exist",s.className="exist",setTimeout((function(){c.className="exist visible",s.className="exist visible"}),10),l.innerText=e,u.innerText=n||"",d.clickHandler&&d.removeEventListener("click",d.clickHandler),h.clickHandler&&h.removeEventListener("click",h.clickHandler),d.clickHandler=function(){t.hide(),setTimeout((function(){a()}),300)},d.addEventListener("click",d.clickHandler),d.innerText=i,r?(h.clickHandler=function(){t.hide(),setTimeout((function(){o()}),300)},h.addEventListener("click",h.clickHandler),h.innerText=r):h.className="hidden"):o()}))}},{key:"hide",value:function(){var e=document.getElementById("overlay"),t=document.getElementById("dialog");e&&t&&(e.className="exist",t.className="exist",setTimeout((function(){e.className="",t.className=""}),300))}},{key:"showModal",value:function(e){var t=this;if(!this.activeModal){var n=document.getElementById("overlay"),i=document.getElementById(e);n&&i&&(n.classList.add("exist"),i.classList.add("exist"),this.activeModal=e,setTimeout((function(){n.classList.add("visible"),i.classList.add("visible")}),10),this.viewportWatcher=setInterval((function(){if(t.activeModal){document.querySelectorAll("#".concat(t.activeModal," .modal-content .content")).forEach((function(e){i.classList.toggle("scrolled",e.scrollHeight>e.clientHeight)}));var e=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);i.classList.toggle("centered",i.clientHeight>.75*e)}}),100))}}},{key:"hideModal",value:function(){var e=this;return new Promise((function(t,n){if(e.activeModal){var i=document.getElementById("overlay"),r=document.getElementById(e.activeModal);i&&r?(e.viewportWatcher&&(clearInterval(e.viewportWatcher),e.viewportWatcher=null),i.classList.remove("visible"),r.classList.remove("visible"),setTimeout((function(){i.classList.remove("exist"),r.classList.remove("exist"),e.activeModal=null,t()}),300)):n()}else n()}))}}],null&&t(n.prototype,null),i&&t(n,i),Object.defineProperty(n,"prototype",{writable:!1}),e}();function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function o(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,(void 0,r=function(e,t){if("object"!==a(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!==a(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(i.key),"symbol"===a(r)?r:String(r)),i)}var r}n(r,"activeModal",null),n(r,"viewportWatcher",null);var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n;return t=e,n=[{key:"prepareResponse",value:function(e){return{xhr:e,status:e.status,statusText:e.statusText,body:e.responseText,success:e.status>=200&&e.status<300||304===e.status}}},{key:"start",value:function(e,t){var n=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return new Promise((function(o,c){var s=new XMLHttpRequest;if(s.open(e,t,!0),"object"===a(r)&&null!==r&&!1===Array.isArray(r))for(var l=0,u=Object.keys(r);l<u.length;l++){var d=u[l];s.setRequestHeader(d,r[d])}s.onload=function(){var e=n.prepareResponse(s);e.success?o(e):c(e)},s.onerror=function(){c(n.prepareResponse(s))},s.send(i)}))}},{key:"get",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.start("GET",t,null,n)}},{key:"post",value:function(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n instanceof URLSearchParams?(i["Content-Type"]="application/x-www-form-urlencoded",e.start("POST",t,n.toString(),i)):"object"===a(n)&&null!==n||Array.isArray(n)?(i["Content-Type"]="application/json",e.start("POST",t,JSON.stringify(n),i)):e.start("POST",t,n,i)}},{key:"delete",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return e.start("DELETE",t,null,n)}}],null&&o(t.prototype,null),n&&o(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}(),s=function(e){return Intl.NumberFormat("en-US",{style:"currency",currency:e}).format},l=function(e){return new Date(1e3*e)},u=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=Intl.DateTimeFormat().resolvedOptions(),r={dateStyle:"medium"};t&&(r.timeStyle="short");var a=Intl.DateTimeFormat(i.locale,r).format(e);return n&&(a="".concat(a," ").concat(i.timeZone)),a};function d(e){return d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},d(e)}function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){k(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function k(e,t,n){return(t=w(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=v(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw a}}}}function v(e,t){if(e){if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,w(i.key),i)}}function b(e,t,n){return t&&g(e.prototype,t),n&&g(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function w(e){var t=function(e,t){if("object"!==d(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,"string");if("object"!==d(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===d(t)?t:String(t)}function A(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function S(e,t){return function(e,t){return t.get?t.get.call(e):t.value}(e,C(e,t,"get"))}function E(e,t,n){return function(e,t,n){if(t.set)t.set.call(e,n);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=n}}(e,C(e,t,"set"),n),n}function C(e,t,n){if(!t.has(e))throw new TypeError("attempted to "+n+" private field on non-instance");return t.get(e)}var B="owns",I="buying",L="in-cart",P="none";document.addEventListener("beaconRunCheckout",(function(e){var t=e.checkoutProperties,n=t.products,i=t.productIds,a=s(t.currencyCode),o=new WeakMap,d=new WeakMap,h=new WeakMap,k=function(){function e(t){p(this,e),A(this,o,{writable:!0,value:null}),A(this,d,{writable:!0,value:{}}),A(this,h,{writable:!0,value:!1}),t?(E(this,o,t.id),E(this,d,t.products),E(this,h,t.isGift)):E(this,o,crypto.randomUUID?crypto.randomUUID():([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,(function(e){return(e^crypto.getRandomValues(new Uint8Array(1))[0]&15>>e/4).toString(16)})))}return b(e,[{key:"id",get:function(){return S(this,o)}},{key:"isGift",get:function(){return S(this,h)},set:function(e){E(this,h,e)}},{key:"productIds",get:function(){return Object.keys(S(this,d))}},{key:"count",get:function(){return Object.keys(S(this,d)).length}},{key:"reset",value:function(){E(this,d,{})}},{key:"add",value:function(e,t){this.setQuantity(e,this.getQuantity(e)+t)}},{key:"remove",value:function(e,t){this.setQuantity(e,this.getQuantity(e)-t)}},{key:"getQuantity",value:function(e){var t;return null!==(t=S(this,d)[e])&&void 0!==t?t:0}},{key:"setQuantity",value:function(e,t){t<=0?Object.prototype.hasOwnProperty.call(S(this,d),e)&&delete S(this,d)[e]:S(this,d)[e]=t}},{key:"toJSON",value:function(){return{id:S(this,o),products:S(this,d),isGift:S(this,h)}}},{key:"fingerprint",get:function(){var e=this,t=Object.keys(S(this,d)).sort().reduce((function(t,n){return t[n]=S(e,d)[n],t}),{});return btoa(JSON.stringify({id:S(this,o),products:t,isGift:S(this,h)}))}},{key:"hasArk",get:function(){var e;return this.getQuantity(null==n||null===(e=n.Ark)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)>0}},{key:"hasArkSA",get:function(){var e,t,i;return this.getQuantity(null==n||null===(e=n.ArkSA)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)>0||this.getQuantity(null==n||null===(t=n.ArkSA)||void 0===t||null===(t=t.Upgrade)||void 0===t?void 0:t.ProductId)>0||this.getQuantity(null==n||null===(i=n.ArkSA)||void 0===i||null===(i=i.Renewal)||void 0===i?void 0:i.ProductId)>0}},{key:"arkSAYears",get:function(){var e,t,i;return Math.min(this.getQuantity(null==n||null===(e=n.ArkSA)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)+this.getQuantity(null==n||null===(t=n.ArkSA)||void 0===t||null===(t=t.Upgrade)||void 0===t?void 0:t.ProductId)+this.getQuantity(null==n||null===(i=n.ArkSA)||void 0===i||null===(i=i.Renewal)||void 0===i?void 0:i.ProductId),10)}},{key:"build",value:function(e,t,i,r){this.reset(),this.isGift=t,i&&(t||null===e.arkLicense)&&this.setQuantity(n.Ark.Base.ProductId,1),r>0&&(r=Math.min(r,5),t?(i?this.setQuantity(n.ArkSA.Upgrade.ProductId,1):this.setQuantity(n.ArkSA.Base.ProductId,1),r>1&&this.setQuantity(n.ArkSA.Renewal.ProductId,r-1)):null!==e.arkSALicense?this.setQuantity(n.ArkSA.Renewal.ProductId,r):(i||null!==e.arkLicense?this.setQuantity(n.ArkSA.Upgrade.ProductId,1):this.setQuantity(n.ArkSA.Base.ProductId,1),r>1&&this.setQuantity(n.ArkSA.Renewal.ProductId,r-1)))}},{key:"rebuild",value:function(e){var t=this.fingerprint;return this.build(e,this.isGift,this.hasArk,this.arkSAYears),this.fingerprint!==t}},{key:"consume",value:function(e,t){if(t){if(this.isGift!==t.isGift)throw new Error("Cannot merge a gift item with a non-gift item.");var n=this.hasArk||t.hasArk,i=this.arkSAYears+t.arkSAYears;this.build(e,this.isGift,n,i)}}},{key:"total",get:function(){var e,t=0,n=m(this.productIds);try{for(n.s();!(e=n.n()).done;){var r=e.value;t+=i[r].Price*this.getQuantity(r)}}catch(e){n.e(e)}finally{n.f()}return t}}]),e}(),g=new WeakMap,w=new WeakMap,C=new WeakMap,T=new WeakMap,x=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(p(this,e),A(this,g,{writable:!0,value:[]}),A(this,w,{writable:!0,value:null}),A(this,C,{writable:!0,value:!1}),A(this,T,{writable:!0,value:[]}),t)try{var n=JSON.parse(t);E(this,w,n.email),E(this,g,n.items.reduce((function(e,t){var n=new k(t);return n.count>0&&e.push(n),e}),[])),E(this,T,n.licenses)}catch(e){console.log("Failed to load saved cart")}}return b(e,[{key:"reset",value:function(){E(this,g,[]),E(this,w,null),E(this,C,!1),E(this,T,[]),this.save()}},{key:"toJSON",value:function(){return{email:S(this,w),items:S(this,g).reduce((function(e,t){return t.count>0&&e.push(t),e}),[]),licenses:S(this,T)}}},{key:"save",value:function(){localStorage.setItem("beaconCart",JSON.stringify(this))}},{key:"add",value:function(e){S(this,g).push(e),this.save()}},{key:"remove",value:function(e){E(this,g,S(this,g).filter((function(t){return t.id!==e.id}))),this.save()}},{key:"hasProduct",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=m(S(this,g));try{for(i.s();!(t=i.n()).done;){var r=t.value;if(r.getQuantity(e)>0&&r.isGift===n)return!0}}catch(e){i.e(e)}finally{i.f()}return!1}},{key:"email",get:function(){return S(this,w)}},{key:"setEmail",value:function(e){var t=this;return new Promise((function(i,r){var a=function(){var e,i=t.personalCartItem;return!!i&&(i.hasArk&&t.arkLicense?(i.setQuantity(null===(e=n.Ark)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId,0),0===i.count&&t.remove(i),!0):i.rebuild(t))};if(null===e){E(t,w,null),E(t,C,!1),E(t,T,[]);var o=a();return t.save(),void i({newEmail:null,cartChanged:o})}if(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).trim().toLowerCase())){var s=new URLSearchParams;s.append("email",e),c.get("/omni/lookup?".concat(s.toString())).then((function(n){var r=JSON.parse(n.body);E(t,w,r.email),E(t,C,r.verified),E(t,T,r.purchases);var o=a();t.save(),i({newEmail:e,cartChanged:o})})).catch((function(e){E(t,w,null),E(t,C,!1),E(t,T,[]),a(),t.save(),r(e.statusText)}))}else r("Address is not valid")}))}},{key:"emailVerified",get:function(){return S(this,C)}},{key:"checkingEmail",get:function(){return!1}},{key:"items",get:function(){return function(e){if(Array.isArray(e))return y(e)}(e=S(this,g))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||v(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}();var e}},{key:"count",get:function(){return S(this,g).reduce((function(e,t){return t.count>0&&e++,e}),0)}},{key:"findLicense",value:function(e){var t,n=m(S(this,T));try{for(n.s();!(t=n.n()).done;){var i=t.value;if(i.productId===e)return i}}catch(e){n.e(e)}finally{n.f()}return null}},{key:"arkLicense",get:function(){var e;return this.findLicense(null==n||null===(e=n.Ark)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)}},{key:"arkSALicense",get:function(){var e;return this.findLicense(null==n||null===(e=n.ArkSA)||void 0===e||null===(e=e.Base)||void 0===e?void 0:e.ProductId)}},{key:"ark2License",get:function(){return null}},{key:"personalCartItem",get:function(){var e,t=m(S(this,g));try{for(t.s();!(e=t.n()).done;){var n=e.value;if(!1===n.isGift)return n}}catch(e){t.e(e)}finally{t.f()}return null}},{key:"total",get:function(){var e,t=0,n=m(S(this,g));try{for(n.s();!(e=n.n()).done;)t+=e.value.total}catch(e){n.e(e)}finally{n.f()}return t}}],[{key:"load",value:function(){return new this(localStorage.getItem("beaconCart"))}}]),e}(),O=x.load(),F=new WeakMap,D=new WeakMap,M=function(){function e(t){p(this,e),A(this,F,{writable:!0,value:[]}),A(this,D,{writable:!0,value:null}),S(this,F).push(t)}return b(e,[{key:"currentView",get:function(){return S(this,F).slice(-1)}},{key:"back",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return!(S(this,F).length<=1||(this.switchView(S(this,F)[S(this,F).length-2],e),E(this,F,S(this,F).slice(0,S(this,F).length-2)),0))}},{key:"clearHistory",value:function(){S(this,F).length<=1||E(this,F,S(this,F).slice(-1))}},{key:"switchView",value:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.currentView!==e){S(this,D)&&(clearTimeout(S(this,D)),E(this,D,null));var i=document.getElementById(this.currentView),r=document.getElementById(e);S(this,F).push(e),n?(i.classList.add("invisible"),E(this,D,setTimeout((function(){i.classList.add("hidden"),r.classList.remove("hidden"),E(t,D,setTimeout((function(){r.classList.remove("invisible"),E(t,D,null)}),150))}),150))):(i.classList.add("hidden"),i.classList.add("invisible"),r.classList.remove("invisible"),r.classList.remove("hidden"))}}}]),e}();new M("checkout-wizard-start");var G=new M("page-landing"),N=document.getElementById("buy-button"),j=document.getElementById("cart-back-button"),z=1===Object.keys(i).length,R=function(){history.pushState({},"","/omni#checkout"),dispatchEvent(new PopStateEvent("popstate",{}))},Q={cancelButton:document.getElementById("checkout-email-cancel"),actionButton:document.getElementById("checkout-email-action"),emailField:document.getElementById("checkout-email-field"),errorField:document.getElementById("checkout-email-error"),allowsSkipping:!1,successFunction:function(e){},init:function(){var e=this,t=function(t){e.actionButton.disabled=!0,e.cancelButton.disabled=!0,e.errorField.classList.add("hidden"),O.setEmail(t).then((function(t){t.newEmail;var n=t.cartChanged;r.hideModal(),setTimeout((function(){e.successFunction(n)}),310)})).catch((function(t){e.errorField.innerText=t,e.errorField.classList.remove("hidden")})).finally((function(){e.actionButton.disabled=!1,e.cancelButton.disabled=!1}))};this.actionButton.addEventListener("click",(function(n){n.preventDefault(),t(e.emailField.value)})),this.cancelButton.addEventListener("click",(function(n){n.preventDefault(),e.allowsSkipping?t(null):r.hideModal()}))},present:function(e,n){t.forceEmail?O.setEmail(t.forceEmail).then((function(e){e.newEmail;var t=e.cartChanged;n(t)})):(this.allowsSkipping=e,this.successFunction=n,O.email?this.emailField.value=O.email:this.emailField.value=sessionStorage.getItem("email")||localStorage.getItem("email")||"",this.cancelButton.innerText=e?"Skip For Now":"Cancel",r.showModal("checkout-email"))}};Q.init();var U={cartView:null,editCartItem:null,cancelButton:document.getElementById("checkout-wizard-cancel"),actionButton:document.getElementById("checkout-wizard-action"),giftCheck:document.getElementById("checkout-wizard-gift-check"),arkSACheck:document.getElementById("checkout-wizard-arksa-check"),arkCheck:document.getElementById("checkout-wizard-ark-check"),arkPriceField:document.getElementById("checkout-wizard-ark-price"),arkSAPriceField:document.getElementById("checkout-wizard-arksa-full-price"),arkSAUpgradePriceField:document.getElementById("checkout-wizard-arksa-discount-price"),arkSAStatusField:document.getElementById("checkout-wizard-status-arksa"),arkStatusField:document.getElementById("checkout-wizard-status-ark"),arkSADurationGroup:document.getElementById("checkout-wizard-arksa-duration-group"),arkSADurationField:document.getElementById("checkout-wizard-arksa-duration-field"),arkSADurationUpButton:document.getElementById("checkout-wizard-arksa-yearup-button"),arkSADurationDownButton:document.getElementById("checkout-wizard-arksa-yeardown-button"),arkSAPromoField:document.getElementById("checkout-wizard-promo-arksa"),arkOnlyCheck:document.getElementById("storefront-ark-check"),arkOnlyGiftField:document.getElementById("storefront-ark-gift-field"),arkOnlyOwnedField:document.getElementById("storefront-ark-owned"),arkOnlyGiftQuantityGroup:document.getElementById("storefront-ark-gift-group"),arkOnlyGiftUpButton:document.getElementById("storefront-ark-gift-increase"),arkOnlyGiftDownButton:document.getElementById("storefront-ark-gift-decrease"),init:function(e){var t=this;if(this.cartView=e,this.cancelButton&&this.cancelButton.addEventListener("click",(function(e){e.preventDefault(),r.hideModal()})),this.actionButton&&this.actionButton.addEventListener("click",(function(e){e.preventDefault();var n=t.giftCheck.checked,i=t.arkCheck&&!1===t.arkCheck.disabled&&t.arkCheck.checked,a=t.arkSACheck&&!1===t.arkSACheck.disabled&&t.arkSACheck.checked;if(!1!==(i||a)){var o,c=a?parseInt(t.arkSADurationField.value)||1:0;if(t.editCartItem?o=t.editCartItem:(o=new k).isGift=n,o.build(O,n,i,c),!1===Boolean(t.editCartItem)){var s=O.personalCartItem;!1===n&&!0===Boolean(s)?s.consume(O,o):O.add(o)}O.save(),t.cartView.update(),R(),r.hideModal()}})),this.giftCheck&&this.giftCheck.addEventListener("change",(function(){t.update()})),this.arkCheck&&this.arkCheck.addEventListener("change",(function(){t.update()})),this.arkSACheck&&this.arkSADurationField&&this.arkSADurationUpButton&&this.arkSADurationDownButton&&this.arkSADurationGroup){this.arkSACheck.addEventListener("change",(function(){t.update()})),this.arkSADurationField.addEventListener("input",(function(){t.update()}));var n=function(e){var n=parseInt(t.arkSADurationField.value),i=n+e;(i>5||i<1)&&(t.arkSADurationGroup.classList.add("shake"),setTimeout((function(){t.arkSADurationGroup.classList.remove("shake")}),400),i=Math.max(Math.min(i,5),1)),n!==i&&(t.arkSADurationField.value=i,t.arkSACheck.checked=!0,t.update())};this.arkSADurationUpButton.addEventListener("click",(function(e){e.preventDefault(),n(1)})),this.arkSADurationDownButton.addEventListener("click",(function(e){e.preventDefault(),n(-1)}))}if(this.arkOnlyCheck&&this.arkOnlyCheck.addEventListener("change",(function(e){if(e.preventDefault(),e.currentTarget.checked){var n=O.personalCartItem;n||(n=new k,O.add(n)),n.build(O,!1,!0,0),O.save()}else{var i=O.personalCartItem;i&&O.remove(i)}t.cartView.update()})),this.arkOnlyGiftField){var i=function(e){var n=O.items.filter((function(e){return!0===e.isGift&&e.hasArk}));if(n.length!==e){if(n.length>e)for(var i=e;i<=n.length-1;i++)O.remove(n[i]);else if(n.length<e)for(var r=n.length;r<e;r++){var a=new k;a.build(O,!0,!0,0),O.add(a)}t.cartView.update()}};this.arkOnlyGiftField.addEventListener("input",(function(e){var t=Math.min(Math.max(parseInt(e.currentTarget.value),0),5);i(t)})),this.arkOnlyGiftField.addEventListener("blur",(function(){t.cartView.update()}));var a=function(e){var n=parseInt(t.arkOnlyGiftField.value),r=n+e;(r>5||r<0)&&(t.arkOnlyGiftQuantityGroup.classList.add("shake"),setTimeout((function(){t.arkOnlyGiftQuantityGroup.classList.remove("shake")}),400),r=Math.max(Math.min(r,5),0)),n!==r&&(t.arkOnlyGiftField.value=r,i(r))};this.arkOnlyGiftUpButton.addEventListener("click",(function(e){e.preventDefault(),a(1)})),this.arkOnlyGiftDownButton.addEventListener("click",(function(e){e.preventDefault(),a(-1)}))}},present:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.editCartItem=e,this.arkCheck.disabled=!1,this.arkSACheck&&(this.arkSACheck.disabled=!1),e?(this.giftCheck.checked=e.isGift,this.giftCheck.disabled=!0,this.arkCheck.checked=e.hasArk,this.arkSACheck&&(this.arkSACheck.checked=e.hasArkSA)):(this.giftCheck.checked=!1,this.giftCheck.disabled=!1,this.arkCheck.checked=!1,this.arkSACheck&&(this.arkSACheck.checked=!1)),this.arkSADurationField&&(this.arkSADurationField.value=e?e.arkSAYears:"1"),this.cancelButton.innerText="Cancel",this.update(),r.showModal("checkout-wizard")},getGameStatus:function(){var e={Ark:P,ArkSA:P},t=O.personalCartItem,n=Boolean(this.editCartItem);return this.giftCheck&&this.giftCheck.checked?(e.Ark=this.arkCheck&&!1===this.arkCheck.disabled&&this.arkCheck.checked?I:P,e.ArkSA=this.arkSACheck&&!1===this.arkSACheck.disabled&&this.arkSACheck.checked?I:P):(O.arkLicense?e.Ark=B:t&&(!1===n||t.id!==this.editCartItem.id)&&t.hasArk?e.Ark=L:this.arkCheck&&!1===this.arkCheck.disabled&&this.arkCheck.checked?e.Ark=I:e.Ark=P,O.arkSALicense?e.ArkSA=B:t&&(!1===n||t.id!==this.editCartItem.id)&&t.hasArkSA?e.ArkSA=L:this.arkSACheck&&this.arkSACheck&&!1===this.arkSACheck.disabled&&this.arkSACheck.checked?e.ArkSA=I:e.ArkSA=P),e},update:function(){var e=this.getGameStatus(),t=0;if(this.arkCheck&&!1===this.arkCheck.disabled&&!0===this.arkCheck.checked&&(t+=n.Ark.Base.Price),this.arkSACheck){var i=n.ArkSA.Base.Price,r=n.ArkSA.Base.Price,o=Math.min(Math.max(parseInt(this.arkSADurationField.value)||1,1),5);parseInt(this.arkSADurationField.value)!==o&&document.activeElement!==this.arkSADurationField&&(this.arkSADurationField.value=o);var c=Math.max(o-1,0),s=Math.round((n.ArkSA.Base.Price-n.ArkSA.Upgrade.Price)/n.ArkSA.Base.Price*100);if(this.arkSAPromoField.innerText="".concat(s,"% off first year when bundled with ").concat(n.Ark.Base.Name),e.ArkSA===B){var d,h=O.arkSALicense,f=Math.floor(Date.now()/1e3),k=h.expiresEpoch,m=u(l(k),!1),v=(f>k?86400*Math.floor(f/86400)+86400:k)+n.ArkSA.Renewal.PlanLengthSeconds*o,y=u(l(v),!1);d=f>k?'Renew your update plan<br>Expired on <span class="text-red">'.concat(m,'</span><br>New expiration: <span class="text-green">').concat(y,"</span>"):'Extend your update plan<br>Expires on <span class="text-green">'.concat(m,'</span><br>New expiration: <span class="text-green">').concat(y,"</span>"),this.arkSAStatusField.innerHTML=d,r=i=n.ArkSA.Renewal.Price*o,this.arkSAPromoField.innerText="",this.arkSAPromoField.classList.add("hidden")}else if(e.ArkSA===L)r=i=n.ArkSA.Renewal.Price*o,this.arkSAStatusField.innerText="Additional renewal years for ".concat(n.ArkSA.Base.Name," in your cart."),this.arkSAPromoField.innerText="",this.arkSAPromoField.classList.add("hidden");else if(e.Ark!==P){i=n.ArkSA.Base.Price+n.ArkSA.Renewal.Price*c,r=n.ArkSA.Upgrade.Price+n.ArkSA.Renewal.Price*c;var p=e.Ark===B?"because you own":"when bundled with";this.arkSAStatusField.innerText="Includes first year of app updates. Additional years cost ".concat(a(n.ArkSA.Renewal.Price)," each."),this.arkSAPromoField.innerText="".concat(s,"% off first year ").concat(p," ").concat(n.Ark.Base.Name),this.arkSAPromoField.classList.remove("hidden")}else this.arkSAStatusField.innerText="Includes first year of app updates. Additional years cost ".concat(a(n.ArkSA.Renewal.Price)," each."),this.arkSAPromoField.innerText="".concat(s,"% off first year when bundled with ").concat(n.Ark.Base.Name),this.arkSAPromoField.classList.remove("hidden"),r=i=n.ArkSA.Base.Price+n.ArkSA.Renewal.Price*c;this.arkSAPriceField.classList.toggle("checkout-wizard-discounted",i!==r),this.arkSAPriceField.innerText=a(i),this.arkSAUpgradePriceField.classList.toggle("hidden",i===r),this.arkSAUpgradePriceField.innerText=a(r),!1===this.arkSACheck.disabled&&!0===this.arkSACheck.checked&&(t+=r)}e.Ark===B?(this.arkStatusField.innerText="You already own ".concat(n.Ark.Base.Name,"."),this.arkCheck.disabled=!0,this.arkCheck.checked=!1):e.Ark===L?(this.arkStatusField.innerText="".concat(n.Ark.Base.Name," is already in your cart."),this.arkCheck.disabled=!0,this.arkCheck.checked=!1):(this.arkStatusField.innerText="Includes lifetime app updates.",this.arkCheck.disabled=!1);var g=this.editCartItem?"Edit":"Add to Cart";t>0?(this.actionButton.disabled=!1,this.actionButton.innerText="".concat(g,": ").concat(a(t))):(this.actionButton.disabled=!0,this.actionButton.innerText=g)}},H={wizard:null,emailField:document.getElementById("storefront-cart-header-email-field"),changeEmailButton:document.getElementById("storefront-cart-header-email-button"),currencyMenu:document.getElementById("storefront-cart-currency-menu"),addMoreButton:document.getElementById("storefront-cart-more-button"),checkoutButton:document.getElementById("storefront-cart-checkout-button"),refundCheckbox:document.getElementById("storefront-refund-checkbox"),footer:document.getElementById("storefront-cart-footer"),body:document.getElementById("storefront-cart"),totalField:document.getElementById("storefront-cart-total"),init:function(e){var t=this;this.wizard=e,this.currencyMenu.addEventListener("change",(function(e){e.preventDefault(),c.get("/omni/currency?currency=".concat(e.target.value)).then((function(){window.location.reload()})).catch((function(e){console.log(JSON.stringify(e)),r.show("Currency was not changed",e.statusText)}))})),this.addMoreButton.addEventListener("click",(function(e){e.preventDefault(),t.wizard.present()})),this.checkoutButton.addEventListener("click",(function(e){e.preventDefault();var n=t.refundCheckbox.checked,i=function(e){t.update(),e?O.count>0?r.show("Your cart contents have changed.","The items in your cart have changed based on your e-mail address. Please review before continuing checkout."):r.show("Your cart is now empty.","You already own everything in your cart. There is no need to purchase again."):(t.checkoutButton.disabled=!0,c.post("/omni/begin",f(f({},O.toJSON()),{},{refundPolicyAgreed:n})).then((function(e){try{var t=JSON.parse(e.body),n=t.url;sessionStorage.setItem("clientReferenceId",t.client_reference_id),window.location=n}catch(t){console.log(e.body),r.show("Unknown Error","There was an unknown error while starting the checkout process.")}})).catch((function(e){try{var t=JSON.parse(e.body).message;r.show("Checkout Error",t)}catch(t){console.log(e.body),r.show("Unknown Error","There was an unknown error while starting the checkout process.")}})).finally((function(){t.checkoutButton.disabled=!1})))};O.email?n?i(!1):r.show("Hang on","Please agree to the refund policy."):Q.present(!1,i)})),this.changeEmailButton.addEventListener("click",(function(e){e.preventDefault(),Q.present(!1,(function(){t.update()}))})),this.update()},update:function(){var e,n=this;if(z){this.emailField.innerText=O.email,this.changeEmailButton.disabled=Boolean(t.forceEmail),this.changeEmailButton.innerText=O.email?"Change Email":"Set Email",this.changeEmailButton.classList.remove("hidden"),this.addMoreButton.classList.add("hidden"),O.arkLicense?(this.wizard.arkOnlyOwnedField.classList.remove("hidden"),this.wizard.arkOnlyCheck.parentElement.classList.add("hidden")):(this.wizard.arkOnlyOwnedField.classList.add("hidden"),this.wizard.arkOnlyCheck.parentElement.classList.remove("hidden"));var i=O.personalCartItem;if(this.wizard.arkOnlyCheck.checked=i&&i.hasArk,document.activeElement!==this.wizard.arkOnlyGiftField){var r=O.items.filter((function(e){return!0===e.isGift&&e.hasArk}));this.wizard.arkOnlyGiftField.value=r.length}}else if(O.count>0)this.emailField.innerText=O.email,this.changeEmailButton.disabled=Boolean(t.forceEmail),this.changeEmailButton.innerText=O.email?"Change Email":"Set Email",this.changeEmailButton.classList.remove("hidden"),this.body.innerText="",this.body.classList.remove("empty"),this.footer.classList.remove("hidden"),O.items.forEach((function(e){var t=n.createCartItemRow(e);t&&n.body.appendChild(t)})),N.innerText="Go to Cart";else{this.emailField.innerText="",this.changeEmailButton.classList.add("hidden"),this.body.innerText="",this.body.classList.add("empty"),this.footer.classList.add("hidden"),this.body.appendChild(document.createElement("div"));var a=document.createElement("div"),o=document.createElement("p");o.appendChild(document.createTextNode("Your cart is empty.")),a.appendChild(o),this.buyMoreButton=document.createElement("button"),this.buyMoreButton.addEventListener("click",(function(){Q.present(!0,(function(){n.wizard.present()}))})),this.buyMoreButton.classList.add("default"),this.buyMoreButton.appendChild(document.createTextNode("Buy Omni"));var c=document.createElement("p");c.appendChild(this.buyMoreButton),a.appendChild(c),this.body.appendChild(a),this.body.appendChild(document.createElement("div")),N.innerText="Buy Omni"}this.totalField.setAttribute("beacon-price",O.total),e=t.currencyCode,document.querySelectorAll(".formatted-price").forEach((function(t){var n,i=parseFloat(null!==(n=t.getAttribute("beacon-price"))&&void 0!==n?n:t.innerText),r=t.getAttribute("beacon-currency"),a=s(null!=r?r:e);a&&(t.innerText=a(i))})),this.checkoutButton.disabled=0===O.total},createProductRow:function(e,t){var n=e.getQuantity(t);if(n<=0)return null;var r=i[t].Name,a=i[t].Price,o=document.createElement("div");o.appendChild(document.createTextNode(n));var c=document.createElement("div");c.appendChild(document.createTextNode(r));var s=document.createElement("div");s.classList.add("formatted-price"),s.appendChild(document.createTextNode(a*n));var l=document.createElement("div");return l.classList.add("bundle-product"),l.appendChild(o),l.appendChild(c),l.appendChild(s),l},createCartItemRow:function(e){var t=this,n=e.productIds;if(n.length<=0)return null;var i=document.createElement("div");i.classList.add("bundle"),n.forEach((function(n){var r=t.createProductRow(e,n);r&&i.appendChild(r)}));var r=document.createElement("div");e.isGift&&(i.classList.add("gift"),r.classList.add("gift"),n.length>1?r.appendChild(document.createTextNode("These products are a gift. You will receive a gift code for them.")):r.appendChild(document.createTextNode("This product is a gift. You will receive a gift code for it.")));var a=document.createElement("button");a.appendChild(document.createTextNode("Edit")),a.classList.add("small"),a.addEventListener("click",(function(n){n.preventDefault(),t.wizard.present(e)}));var o=document.createElement("button");o.appendChild(document.createTextNode("Remove")),o.classList.add("red"),o.classList.add("small"),o.addEventListener("click",(function(n){n.preventDefault(),O.remove(e),t.update()}));var c=document.createElement("div");c.classList.add("button-group"),c.appendChild(a),c.appendChild(o);var s=document.createElement("div");s.appendChild(c);var l=document.createElement("div");return l.classList.add("actions"),l.classList.add("double-group"),l.appendChild(r),l.appendChild(s),i.appendChild(l),i}};U.init(H),H.init(U);var V=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];window.scrollTo(window.scrollX,0),"#checkout"===window.location.hash?G.switchView("page-cart",e):G.back(e)};N.addEventListener("click",(function(e){e.preventDefault(),z||O.count>0?R():Q.present(!0,(function(){U.present()}))})),j.addEventListener("click",(function(){history.pushState({},"","/omni"),dispatchEvent(new PopStateEvent("popstate",{}))})),window.addEventListener("popstate",(function(){V(!0)})),V(!1),t.forceEmail&&(O.email!==t.forceEmail&&O.reset(),0===O.count?Q.present(!0,(function(){U.present()})):R())}))})();
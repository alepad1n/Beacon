"use strict";function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return typeof key==="symbol"?key:String(key)}function _toPrimitive(input,hint){if(typeof input!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(typeof res!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return(hint==="string"?String:Number)(input)}class ExplorePopover{static init(){this.container=document.getElementById("explore_container");this.popover=document.getElementById("explore_popover");this.field=document.getElementById("explore_search_field");this.link=document.getElementById("menu_explore_link");if(!(this.container&&this.popover&&this.field&&this.link)){return}this.container.addEventListener("click",ev=>{this.dismiss();ev.stopPropagation();ev.stopImmediatePropagation();return false});this.popover.addEventListener("click",ev=>{ev.stopPropagation();ev.stopImmediatePropagation();return false});this.link.addEventListener("click",ev=>{ev.stopPropagation();ev.preventDefault();ev.stopImmediatePropagation();this.toggle();return false});this.field.addEventListener("input",ev=>{if(ev.target.searchTimeout){clearTimeout(ev.target.searchTimeout);ev.target.searchTimeout=null}ev.target.searchTimeout=setTimeout(()=>{this.search(this.field.value)},1000)});document.getElementById("explore_results_back").addEventListener("click",ev=>{this.search("")});document.getElementById("explore_results_more").addEventListener("click",ev=>{window.location=this.searchMoreURL});window.addEventListener("blur",ev=>{this.dismiss()})}static toggle(){if(this.container.style.display=="none"||this.container.style.display==""){this.present()}else{this.dismiss()}}static dismiss(){if(this.container.style.display=="none"){return}this.container.style.display="none";this.link.className="";this.field.value="";this.displayResults()}static present(){if(this.container.style.display=="block"){return}var rect=this.link.getBoundingClientRect();this.popover.style.top=rect.bottom+"px";this.popover.style.left=Math.max(rect.left+(rect.width-320)/2,20)+"px";this.container.style.display="block";this.link.className="expanded"}static search(terms){if(!terms){terms=""}if(this.field.value!==terms){this.field.value=terms}if(terms===""){this.displayResults();return}var params=new URLSearchParams;params.append("query",terms.trim());params.append("count",4);BeaconWebRequest.get("/search?".concat(params.toString()),{Accept:"application/json"}).then(response=>{try{this.displayResults(JSON.parse(response.body))}catch(e){console.log(e);this.displayResults()}}).catch(error=>{this.displayResults()})}static displayResults(){var data=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var resultsContainer=document.getElementById("explore_results");var menu=document.getElementById("explore_links");if(!(data&&data.results)){resultsContainer.style.display="none";menu.style.display="block";return}var list=document.getElementById("explore_results_list");while(list.firstChild){list.removeChild(list.firstChild)}var results=data.results;var total=data.total;var terms=data.terms;if(results.length>0){menu.style.display="block";document.getElementById("explore_results_empty").style.display="none";var i=0;for(var result of results){var link=document.createElement("a");link.href=result.url;var tag=document.createElement("span");tag.className="result_type";tag.appendChild(document.createTextNode(result.type));link.appendChild(tag);link.appendChild(document.createTextNode(result.title));if(result.summary!==""){var preview=document.createElement("span");preview.className="result_preview";preview.appendChild(document.createTextNode(result.summary));link.appendChild(document.createElement("br"));link.appendChild(preview)}var node=document.createElement("li");if(i%2==0){node.className="result even"}else{node.className="result odd"}i++;node.appendChild(link);list.appendChild(node)}}else{menu.style.display="none";document.getElementById("explore_results_empty").style.display="block"}if(total>results.length){document.getElementById("explore_results_right_button").style.display="block";this.searchMoreURL="/search/?query="+encodeURIComponent(terms)}else{document.getElementById("explore_results_right_button").style.display="none"}resultsContainer.style.display="block";menu.style.display="none"}}_defineProperty(ExplorePopover,"container",null);_defineProperty(ExplorePopover,"popover",null);_defineProperty(ExplorePopover,"field",null);_defineProperty(ExplorePopover,"link",null);_defineProperty(ExplorePopover,"searchMoreURL","");document.addEventListener("DOMContentLoaded",()=>{ExplorePopover.init()});